<ion-view ng-class="ion-view-background">
    <ion-nav-buttons side="left">
      <button ng-if="!sel_spec.author_email" class="button button-icon ion-gear-a" ng-click="author_spec_sel_modal.show()">
        Evaluation spec
      </button>
      <div ng-if="sel_spec.author_email">
        <button class="button button-icon ion-refresh" side="left" ng-click="resetAndRefresh()"></button>
        <ion-title>{{sel_spec.full_spec.name}}</ion-title>
        <button class="button button-icon ion-edit" side="right" ng-click="author_spec_sel_modal.show()">
        </button>
      </div>
    </ion-nav-buttons>
    <ion-content class="has-header">
        <ion-card ng-if="(sel_spec.full_spec)
                         && (curr_phone.registered)
                         && (curr_phone.isAccuracyControl)
                         && (eval_settings.label)"
            id="eval-settings"
            class="card {{trip_settings_card_display.class}}">
            <ion-item class="item-divider">
            Select trip in experiment
            <div ng-if="eval_trip.raw.label"
                ng-click="toggleTripCardDisplay()"
                class="arrow-position">
                <i class="icon {{trip_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <button-bar class="button-bar">
                <button ng-if="!eval_trip.raw.label"
                    class="button button-block"
                    ng-click="selectEvaluationTrip()">
                    Select trip
                </button>
                <button ng-if="eval_trip.raw.label"
                    class="button button-block"
                    ng-click="selectEvaluationTrip()">
                    {{eval_trip.raw.label}}
                </button>
            </button-bar>
            <div class="row" style="color:black;text-align:center">Trip</div>
            <button-bar class="button-bar row">
                <button class="button button-block trip-control-button"
                    ng-disabled="!eval_trip.waiting_for_trip_start"
                    ng-click="startEvalTrip()"> Start </button>
                <button class="button button-block trip-control-button"
                    ng-disabled="!eval_trip.ongoing_trip"
                    ng-click="endEvalTrip()"> End </button>
            </button-bar>
            </div>
            <leaflet ng-if="eval_trip.raw.label" geojson="eval_trip.gj"
                id="eval-trip" defaults="mapCtrl.defaults"
            height="50%" width="100%" data-tap-disabled="true">
            </leaflet>
        </ion-card>
        <ion-card ng-if="sel_spec.full_spec
                            && (curr_phone.registered)
                            && (!eval_settings.label)"
            id="eval-settings"
            class="card expanded-calibration-settings-card">
            <ion-item class="item-divider">
            <div class="row">
                <div class="col-75">
                    Calibrate phones
                </div>
                <div class="col-25">
                <label ng-if="(calibration.curr_test)
                                && (!eval_settings.label)"
                       class="toggle toggle-color">
                   <input type="checkbox" ng-model="calibration.on"
                        ng-changed="startCalibration()">
                   <div class="track">
                     <div class="handle"></div>
                   </div>
                </label>
                </div>
            </div>
            </ion-item>
            <button-bar class="button-bar row">
                <button class="button button-block col-75"
                    ng-click="selectCalibrationTest()">
                    {{calibration.curr_test.label}}
                </button>
                <button ng-if="calibration.curr_test.label"
                    class="button icon ion-information-circled col-25"
                    ng-click="config_settings_popover.show($event)">
                </button>
            </button-bar>
            <leaflet geojson="calibration.gj"
                id="eval-calibration" defaults="mapCtrl.defaults"
                height="80%" width="100%" data-tap-disabled="true">
            </leaflet>
        </ion-card>
        <ion-card id="eval-settings" ng-if="sel_spec.full_spec"
            class="card {{sensing_settings_card_display.class}}">
            <ion-item class="item-divider">Select regimes to compare
            <div ng-click="toggleSensingCardDisplay()" class="arrow-position">
                <i class="{{sensing_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <button class="button button-block"
                ng-click="selectSensingSettings()">
                <div ng-if="!eval_settings.label">
                Select sensing regime
                </div>
                <div ng-if="eval_settings.label">
                {{eval_settings.label}}
                </div>
            </button>
            <ion-item ng-repeat="(k,v) in eval_settings">
                <b>{{k}}:</b> {{v}}
            </ion-item>
        </ion-card>
        <ion-card id="eval-settings" class="card {{eval_settings_card_display.class}}">
            <ion-item class="item-divider">Choose experiment spec
            <div ng-click="toggleEvalCardDisplay()" class="arrow-position">
                <i class="{{eval_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <ion-item ng-style="$scope.curr_phone.registered ? {} : {color: 'red'}">
                {{curr_phone.email}} ({{curr_phone.profile}})
            </ion-item>
            <ion-item>Author: {{sel_spec.author_email}}</ion-item>
            <ion-item>Start: {{sel_spec.full_spec.start_fmt_date}} to End: {{sel_spec.full_spec.end_fmt_date}}</ion-item>
            <ion-item>Manufacturer: {{device_info.manufacturer}}</ion-item>
            <ion-item>Model: {{device_info.model}}</ion-item>
            <ion-item>Version: {{device_info.version}}</ion-item>
        </ion-card>
    </ion-content>
</ion-view>
