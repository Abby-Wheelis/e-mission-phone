<ion-view ng-class="ion-view-background">
    <ion-nav-buttons side="left">
      <button ng-if="!sel_author_spec.author_email" class="button button-icon ion-gear-a" ng-click="author_spec_sel_modal.show()">
        Evaluation spec
      </button>
      <div ng-if="sel_author_spec.author_email">
        <button class="button button-icon ion-refresh" side="left" ng-click="resetAndRefresh()"></button>
        <ion-title>{{sel_author_spec.sel_spec.name}}</ion-title>
        <button class="button button-icon ion-edit" side="right" ng-click="author_spec_sel_modal.show()">
        </button>
      </div>
    </ion-nav-buttons>
    <ion-content class="has-header">
        <ion-card id="eval-settings" class="card {{eval_settings_card_display.class}}">
            <ion-item class="item-divider">Choose experiment spec
            <div ng-click="toggleEvalCardDisplay()" class="arrow-position">
                <i class="{{eval_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <ion-item ng-style="$scope.curr_regime.registered ? {} : {color: 'red'}">
                {{curr_regime.email}} ({{curr_regime.profile}})
            </ion-item>
            <ion-item>Author: {{sel_author_spec.author_email}}</ion-item>
            <ion-item>Start: {{sel_author_spec.sel_spec.start_fmt_date}} to End: {{sel_author_spec.sel_spec.end_fmt_date}}</ion-item>
            <ion-item>Manufacturer: {{device_info.manufacturer}}</ion-item>
            <ion-item>Model: {{device_info.model}}</ion-item>
            <ion-item>Version: {{device_info.version}}</ion-item>
        </ion-card>
        <ion-card ng-if="sel_author_spec.sel_spec
                            && (curr_regime.registered)
                            && (!curr_regime.evaluation.sensing_settings.label)"
            id="eval-settings"
            class="card small-calibration-settings-card">
            <ion-item class="item-divider">
            <div class="row">
                <div class="col-75">
                    Calibrate phones
                </div>
                <div class="col-25">
                <label ng-if="(calibration.curr_test)
                                && (!curr_regime.evaluation.on)"
                       class="toggle toggle-color">
                   <input type="checkbox" ng-model="calibration.on"
                        ng-changed="startCalibration()">
                   <div class="track">
                     <div class="handle"></div>
                   </div>
                </label>
                </div>
            </div>
            </ion-item>
            <button class="button button-block"
                ng-click="selectCalibrationTest()">
                {{calibration.curr_test}}
            </button>
        </ion-card>
        <ion-card id="eval-settings" ng-if="sel_author_spec.sel_spec"
            class="card {{sensing_settings_card_display.class}}">
            <ion-item class="item-divider">Select regimes to compare
            <div ng-click="toggleSensingCardDisplay()" class="arrow-position">
                <i class="{{sensing_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <button class="button button-block"
                ng-click="selectSensingSettings()">
                <div ng-if="!curr_regime.evaluation.sensing_settings.label">
                Select sensing regime
                </div>
                <div ng-if="curr_regime.evaluation.sensing_settings.label">
                {{curr_regime.evaluation.sensing_settings.label}}
                </div>
            </button>
            <ion-item ng-repeat="(k,v) in curr_regime.evaluation.sensing_settings">
                <b>{{k}}:</b> {{v}}
            </ion-item>
        </ion-card>
        <ion-card ng-if="(sel_author_spec.sel_spec)
                                && (curr_regime.registered)
                                && (curr_regime.isAccuracyControl)
                                && (curr_regime.evaluation.sensing_settings.label)"
            id="eval-settings"
            class="card {{trip_settings_card_display.class}}">
            <ion-item class="item-divider">
            Select trip in experiment
            <div ng-if="curr_regime.evaluation.curr_trip.label"
                ng-click="toggleTripCardDisplay()"
                class="arrow-position">
                <i class="icon {{trip_settings_card_display.icon}}"></i>
            </div>
            </ion-item>
            <button-bar class="button-bar">
                <button ng-if="!curr_regime.evaluation.curr_trip.label"
                    class="button button-block"
                    ng-click="selectEvaluationTrip()">
                    Select trip
                </button>
                <button ng-if="curr_regime.evaluation.curr_trip.label"
                    class="button button-block"
                    ng-click="toggleTripCardDisplay()">
                    {{curr_regime.evaluation.curr_trip.label}}
                </button>
            </button-bar>
            <div class="row" style="color:black;text-align:center">Trip</div>
            <button-bar class="button-bar row">
                <button class="button button-block trip-control-button"
                    ng-disabled="!curr_regime.evaluation.waiting_for_trip_start"
                    ng-click="startEvalTrip()"> Start </button>
                <button class="button button-block trip-control-button"
                    ng-disabled="!curr_regime.evaluation.ongoing_trip"
                    ng-click="endEvalTrip()"> End </button>
            </button-bar>
            </div>
            <leaflet geojson="curr_regime.evaluation.curr_tripgj"
                id="eval" defaults="mapCtrl.defaults"
            height="50%" width="100%" data-tap-disabled="true">
            </leaflet>
        </ion-card>
    </ion-content>
</ion-view>
